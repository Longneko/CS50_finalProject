{% extends "constructor.html" %}

{% block title %}
    Ingredients
{% endblock %}

{% block create %}
    <p>
        <button class="btn btn-success" type="button" data-toggle="collapse" data-target="#collapsable_new" aria-expanded="false" aria-controls="collapsable_new">
            Add new ingredient
        </button>
    </p>
    <div class="collapse" id="collapsable_new">
        <form action="/constructor/ingredients" method="post">
            <div class="form-group">
                <label for="name">Name</label>
                <input type="text" class="form-control" id="name" name="name" required>
                <small id="name" class="form-text text-muted">Names must be unique.</small>
            </div>
            <div class="form-group">
                <label for="category_select">Category</label>
                <select class="form-control" id="category_select" name="category_id" required>
                    <option value=0 selected="selected" disabled></option>
                    {% for c in categories %}
                        <option value={{ c["id"] }}>{{ c["name"] }}</option>
                    {% endfor %}
                </select>
            </div>
            <button class="btn btn-warning" type="button" data-toggle="collapse" data-target="#collapsable_allergies" aria-expanded="false" aria-controls="collapsable_allergies">
                Allergies
            </button>
            <div class="collapse" id="collapsable_allergies">
                <ul>
                    {% for a in allergies %}
                        <li><input type=checkbox name=allergies value="{{ a['id'] }}"> {{ a["name"] }}</li>
                    {% endfor %}
                </ul>
            </div>
            <br>
            <br>
            <button type="submit" class="btn btn-primary">Save</button>
        </form>
    </div>
{% endblock %}

{% block table %}
    {% if rows %}
        <table class="table-sm table-hover table-bordered mx-auto">
            <thead>
                <tr>
                    {% for key in rows[0].keys() %}
                        <th scope="col">{{ key | title }}</th>
                    {% endfor %}
                    <th scope="col">Allergies</th>
                    <th scope="col">Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for row in rows %}
                    <tr>
                        {% for item in row %}
                            <td>
                                {{ item }}
                            </td>
                        {% endfor %}
                        <td>
                            {{ ingredient_allergies[row["id"]] | join(', ') }}
                        </td>
                        <td>
                            edit delete
                        </td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    {% endif %}
{% endblock %}
