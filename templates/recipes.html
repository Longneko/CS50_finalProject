{% extends "admin.html" %}

{% macro content_to_td(content) -%}
    {% set ns = namespace(content=content, td_str="") %}
    {% set ns.td_str = ns.content["ingredient"] %}
    {% if ns.content["amount"] %}
        {% set ns.td_str = ns.td_str + " - " + ns.content["amount"]|string %}
    {% endif %}
    {% if ns.content["units"] %}
        {% set ns.td_str = ns.td_str + " " + ns.content["units"] %}
    {% endif %}

    {{ ns.td_str }}
{%- endmacro %}


# row[key] is scoped outside the "summary_td" block of the admin.html #
{% block summary_td %}
    {% if row[key][0]|is_content %}
        <td class="td-list">
            <ul>
                {% for item in row[key] %}
                    <li>{{ content_to_td(item) }}</li>
                {% endfor %}
            </ul>
        </td>
    {% else %}
        {{ super() }}
    {% endif %}
{% endblock %} %}

{% block app_scripts %}
    <!-- JavaScript for this page -->
    {{ super() }}
    <script src="/static/scripts_recipes.js" type="text/javascript"></script>
{% endblock %}

{% block title %}
    Recipes
{% endblock %}

{% block create %}
    <p>
        <button class="btn btn-success" type="button" data-toggle="collapse" data-target="#collapsable_new" aria-expanded="false" aria-controls="collapsable_new">
            Add new recipe
        </button>
    </p>
    <div class="collapse" id="collapsable_new">
        <form action="/admin/recipes" method="post" id="recipe_new">
            <div class="form-group">
                <label for="name">Name</label>
                <input type="text" class="form-control" id="name" name="name" required>
                <small class="form-text text-muted">Names must be unique.</small>
            </div>
            <div class="form-group">
                <label for="instructions">Instructions</label>
                <textarea class="form-control" id="instructions" name="instructions"></textarea>
                <small class="form-text text-muted">Instructions should not contain the list of ingredients.</small>
            </div>
            <input type="hidden" class="hidden" id="contents" name="contents" required/>
            <input type="submit" class="hidden" id="new_save" hidden/>
        </form>
        <button class="btn btn-info" type="button" data-toggle="collapse" data-target="#collapsable_contents" aria-expanded="false" aria-controls="collapsable_contents">
            Contents
        </button>
        <div class="collapse" id="collapsable_contents">
            <div class=".form-row">
                <select class="form-control" id="ingredient_select" name="ingredient_id">
                    <option value=0 selected="selected" disabled>select ingredient</option>
                    {% for i in ingredients %}
                        <option value={{ i["id"] }}>{{ i["name"] }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class=".form-row">
                <div class="col">
                    <input type="number" class="form-control" id="amount" name="amount" placeholder="amount" min=0>
                    <small class="form-text text-muted">Set 0 for arbitrary amounts, e.g. for seasonings.</small>
                </div>
                <div class="col">
                    <input type="text" class="form-control" id="units" name="units" placeholder="units(optional)">
                </div>
            </div>
            <button type="button" class="btn btn-info" id="contents_add" >Add</button>
            <div class ="badge-container" id="added_contents"></div>
        </div>
        <br>
        <br>
        <label for="new_save" class="btn btn-primary">Save</label>
    </div>
{% endblock %}
